<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abeja - Sistema Esquel√©tico | Clase de Naturales</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FFD700;
            --secondary: #8B4513;
            --accent: #FF8C00;
            --dark: #1a1a2e;
            --light: #f8f9fa;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: var(--light);
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
        }

        .header {
            text-align: center;
            padding: 2rem 1rem;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-bottom: 3px solid var(--primary);
        }

        .title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-family: 'Merriweather', serif;
            color: var(--primary);
        }

        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 1rem;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .model-panel {
            width: 100%;
            max-width: 900px;
            height: 600px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
            background: linear-gradient(45deg, #2a5298, #1e3c72);
            border: 3px solid var(--primary);
            position: relative;
        }

        model-viewer {
            width: 100%;
            height: 100%;
            --poster-color: transparent;
            --progress-bar-color: var(--primary);
        }

        /* Controles de animaci√≥n avanzados */
        .animation-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 900px;
            margin: 1rem 0;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .control-group h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .control-btn {
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.secondary {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .speed-control {
            width: 100%;
            margin: 1rem 0;
        }

        .speed-control label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary);
            font-weight: 600;
        }

        .speed-control input {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .speed-control input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        /* Informaci√≥n del esqueleto */
        .skeleton-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            max-width: 900px;
            width: 100%;
            backdrop-filter: blur(10px);
            border: 2px solid var(--secondary);
        }

        .bone-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .bone-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease;
        }

        .bone-item:hover {
            transform: translateX(5px);
        }

        .bone-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        /* Estado de animaci√≥n */
        .animation-status {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 2px solid var(--primary);
            font-size: 0.9rem;
            z-index: 10;
        }

        .status-playing {
            color: #4CAF50;
        }

        .status-paused {
            color: #FF9800;
        }

        .status-stopped {
            color: #f44336;
        }

        @media (max-width: 768px) {
            .model-panel {
                height: 400px;
            }
            
            .animation-controls {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1 class="title">Sistema Esquel√©tico de la Abeja</h1>
        <p class="subtitle">Estudio del esqueleto y animaciones del modelo 3D con rigging humanoide</p>
    </header>

    <div class="container">
        <div class="model-panel">
            <div class="animation-status" id="animationStatus">
                Estado: <span class="status-stopped">Detenido</span>
            </div>
            
            <model-viewer
                id="bee-model"
                src="pinsesa.glb"
                alt="Modelo 3D de abeja con esqueleto humanoide"
                camera-controls
                ar
                shadow-intensity="1.5"
                exposure="1.2"
                environment-image="neutral"
                camera-orbit="0deg 75deg 105%"
                autoplay>
            </model-viewer>
        </div>

        <!-- Controles avanzados de animaci√≥n -->
        <div class="animation-controls">
            <div class="control-group">
                <h3>üé¨ Control de Animaciones</h3>
                <button class="control-btn" id="playAnimation">
                    <span>‚ñ∂Ô∏è</span> Reproducir Animaci√≥n
                </button>
                <button class="control-btn secondary" id="pauseAnimation">
                    <span>‚è∏Ô∏è</span> Pausar
                </button>
                <button class="control-btn secondary" id="stopAnimation">
                    <span>‚èπÔ∏è</span> Detener
                </button>
                
                <div class="speed-control">
                    <label for="animationSpeed">üéöÔ∏è Velocidad de Animaci√≥n</label>
                    <input type="range" id="animationSpeed" min="0.1" max="3" step="0.1" value="1">
                    <div id="speedValue" style="text-align: center; margin-top: 0.5rem;">1.0x</div>
                </div>
            </div>

            <div class="control-group">
                <h3>ü¶¥ Visualizaci√≥n de Huesos</h3>
                <button class="control-btn secondary" id="toggleSkeleton">
                    <span>üíÄ</span> Mostrar Esqueleto
                </button>
                <button class="control-btn secondary" id="highlightBones">
                    <span>üîç</span> Resaltar Articulaciones
                </button>
                <button class="control-btn" id="resetView">
                    <span>üîÑ</span> Vista Inicial
                </button>
                <button class="control-btn secondary" id="arButton">
                    <span>üì±</span> Realidad Aumentada
                </button>
            </div>
        </div>

        <!-- Informaci√≥n del sistema esquel√©tico -->
        <div class="skeleton-info">
            <h2>ü¶¥ Sistema Esquel√©tico de la Abeja</h2>
            <p>El modelo utiliza un rigging humanoide con las siguientes articulaciones principales:</p>
            
            <div class="bone-list">
                <div class="bone-item">
                    <strong>Cadera (Hip)</strong>
                    Punto central del esqueleto
                </div>
                <div class="bone-item">
                    <strong>Columna (Spine)</strong>
                    Eje central del cuerpo
                </div>
                <div class="bone-item">
                    <strong>Cabeza (Head)</strong>
                    Control de rotaci√≥n cef√°lica
                </div>
                <div class="bone-item">
                    <strong>Hombros (Shoulders)</strong>
                    Articulaci√≥n de alas anteriores
                </div>
                <div class="bone-item">
                    <strong>Codos (Elbows)</strong>
                    Flexi√≥n de alas medias
                </div>
                <div class="bone-item">
                    <strong>Mu√±ecas (Wrists)</strong>
                    Control de alas posteriores
                </div>
                <div class="bone-item">
                    <strong>Piernas (Legs)</strong>
                    Patas para caminar y aterrizar
                </div>
                <div class="bone-item">
                    <strong>Rodillas (Knees)</strong>
                    Articulaci√≥n de patas medias
                </div>
                <div class="bone-item">
                    <strong>Tobillos (Ankles)</strong>
                    Control de patas posteriores
                </div>
            </div>
        </div>

        <!-- Explicaci√≥n de animaciones -->
        <div class="skeleton-info">
            <h2>üé≠ Tipos de Animaci√≥n Disponibles</h2>
            <div class="bone-list">
                <div class="bone-item">
                    <strong>Vuelo B√°sico</strong>
                    Movimiento de alas y estabilizaci√≥n
                </div>
                <div class="bone-item">
                    <strong>Aterrizaje</strong>
                    Coordinaci√≥n de patas y alas
                </div>
                <div class="bone-item">
                    <strong>Caminar</strong>
                    Movimiento terrestre coordinado
                </div>
                <div class="bone-item">
                    <strong>Alimentaci√≥n</strong>
                    Uso de prob√≥scide y antenas
                </div>
                <div class="bone-item">
                    <strong>Comunicaci√≥n</strong>
                    Danzas y movimientos sociales
                </div>
                <div class="bone-item">
                    <strong>Defensa</strong>
                    Posici√≥n de ataque con aguij√≥n
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.126.0/build/three.module.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.126.0/examples/jsm/loaders/GLTFLoader.js';

        document.addEventListener('DOMContentLoaded', async () => {
            const modelViewer = document.getElementById('bee-model');
            const statusElement = document.getElementById('animationStatus');
            const statusText = statusElement.querySelector('span');
            
            // Elementos de control
            const playBtn = document.getElementById('playAnimation');
            const pauseBtn = document.getElementById('pauseAnimation');
            const stopBtn = document.getElementById('stopAnimation');
            const speedSlider = document.getElementById('animationSpeed');
            const speedValue = document.getElementById('speedValue');
            const skeletonBtn = document.getElementById('toggleSkeleton');
            const bonesBtn = document.getElementById('highlightBones');
            const resetBtn = document.getElementById('resetView');
            const arBtn = document.getElementById('arButton');

            let currentAnimation = null;
            let mixer = null;
            let skeletonHelper = null;
            let model = null;

            // Cargar el modelo con Three.js para control avanzado
            async function loadModelWithThreeJS() {
                try {
                    const loader = new GLTFLoader();
                    // Necesitamos obtener la URL del modelo del model-viewer
                    const modelUrl = modelViewer.src;
                    
                    loader.load(modelUrl, (gltf) => {
                        model = gltf.scene;
                        console.log('Modelo cargado:', model);
                        
                        // Configurar el mixer de animaciones
                        mixer = new THREE.AnimationMixer(model);
                        
                        // Listar todas las animaciones disponibles
                        const animations = gltf.animations;
                        console.log('Animaciones disponibles:', animations);
                        
                        if (animations && animations.length > 0) {
                            // Reproducir la primera animaci√≥n por defecto
                            currentAnimation = mixer.clipAction(animations[0]);
                            currentAnimation.play();
                            updateStatus('playing');
                        }
                        
                        // Configurar actualizaci√≥n del mixer
                        function animate() {
                            if (mixer) {
                                mixer.update(0.016); // 60 FPS
                            }
                            requestAnimationFrame(animate);
                        }
                        animate();
                    });
                } catch (error) {
                    console.log('Usando model-viewer nativo para animaciones');
                }
            }

            // Controlar animaciones del model-viewer
            function setupModelViewerAnimations() {
                modelViewer.addEventListener('load', () => {
                    console.log('Modelo cargado en model-viewer');
                    
                    // Obtener todas las animaciones disponibles
                    const animations = modelViewer.availableAnimations;
                    console.log('Animaciones disponibles:', animations);
                    
                    if (animations && animations.length > 0) {
                        // Reproducir la primera animaci√≥n
                        modelViewer.animationName = animations[0];
                        modelViewer.play();
                        updateStatus('playing');
                    }
                });
            }

            // Actualizar estado de la animaci√≥n
            function updateStatus(status) {
                statusText.className = '';
                switch(status) {
                    case 'playing':
                        statusText.textContent = 'Reproduciendo';
                        statusText.classList.add('status-playing');
                        break;
                    case 'paused':
                        statusText.textContent = 'Pausado';
                        statusText.classList.add('status-paused');
                        break;
                    case 'stopped':
                        statusText.textContent = 'Detenido';
                        statusText.classList.add('status-stopped');
                        break;
                }
            }

            // Controladores de eventos
            playBtn.addEventListener('click', () => {
                if (modelViewer.availableAnimations && modelViewer.availableAnimations.length > 0) {
                    modelViewer.play();
                    updateStatus('playing');
                }
            });

            pauseBtn.addEventListener('click', () => {
                modelViewer.pause();
                updateStatus('paused');
            });

            stopBtn.addEventListener('click', () => {
                modelViewer.animationName = null;
                updateStatus('stopped');
            });

            speedSlider.addEventListener('input', (e) => {
                const speed = parseFloat(e.target.value);
                modelViewer.animationTimeScale = speed;
                speedValue.textContent = speed.toFixed(1) + 'x';
            });

            skeletonBtn.addEventListener('click', () => {
                alert('Funci√≥n avanzada: Visualizaci√≥n de esqueleto (requiere Three.js avanzado)');
            });

            bonesBtn.addEventListener('click', () => {
                alert('Resaltando articulaciones del rig humanoide...');
            });

            resetBtn.addEventListener('click', () => {
                modelViewer.cameraOrbit = '0deg 75deg 105%';
                modelViewer.fieldOfView = '30deg';
            });

            arBtn.addEventListener('click', () => {
                modelViewer.activateAR();
            });

            // Inicializar
            setupModelViewerAnimations();
            // loadModelWithThreeJS(); // Descomentar para control avanzado con Three.js
        });
    </script>
</body>
</html>
